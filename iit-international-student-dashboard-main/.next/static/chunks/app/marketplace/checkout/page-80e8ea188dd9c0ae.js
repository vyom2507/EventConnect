(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{3257:function(e,t,r){Promise.resolve().then(r.bind(r,2531))},2531:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var s=r(7437),n=r(9178),i=r(6267),a=r(2660),l=r(8226),c=r(6275),o=r(7648),d=r(2265),u=r(3145);function x(){let{items:e,clearCart:t}=(0,i.r)(),[r,x]=(0,d.useState)(!1),[f,m]=(0,d.useState)(null),p=e.reduce((e,t)=>e+t.product.priceCents*t.quantity,0),h=async()=>{m(null),x(!0);try{let r=await fetch("./api/marketplace/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e.map(e=>({id:e.product.id,title:e.product.title,priceCents:e.product.priceCents,quantity:e.quantity}))})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"Checkout failed")}let s=await r.json();if(s.url)t(),window.location.href=s.url;else throw Error("No Stripe checkout URL returned")}catch(e){m(e.message||"Something went wrong with Stripe checkout")}finally{x(!1)}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(o.default,{href:"/marketplace",className:"inline-flex items-center gap-1 text-[11px] text-slate-300 hover:text-slate-100",children:[(0,s.jsx)(a.Z,{className:"h-3 w-3"}),"Back to marketplace"]}),(0,s.jsxs)(n.Z,{children:[(0,s.jsxs)("header",{className:"mb-3 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-red-600/20 text-red-300 ring-1 ring-red-500/40",children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-sm font-semibold text-slate-50",children:"Checkout (test mode)"}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:"Review your items and pay securely via Stripe. Use Stripe's test card numbers during development."})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 text-xs lg:grid-cols-[minmax(0,1.8fr),minmax(260px,1fr)]",children:[(0,s.jsx)("div",{className:"space-y-2",children:0===e.length?(0,s.jsx)("p",{className:"text-slate-400",children:"Your cart is empty. Add some items from the marketplace first."}):e.map(e=>(0,s.jsxs)("div",{className:"flex gap-3 rounded-lg bg-slate-950/70 p-2.5 ring-1 ring-slate-800",children:[(0,s.jsx)("div",{className:"relative h-14 w-14 overflow-hidden rounded-md bg-slate-900",children:e.product.imageUrl?(0,s.jsx)(u.default,{src:e.product.imageUrl,alt:e.product.title,fill:!0,className:"object-cover"}):(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center text-[9px] text-slate-500",children:"No image"})}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[11px] font-semibold text-slate-100 line-clamp-1",children:e.product.title}),(0,s.jsxs)("p",{className:"text-[10px] text-slate-400",children:["Qty: ",e.quantity," \xb7 ",e.product.condition]})]}),(0,s.jsxs)("p",{className:"text-[11px] text-slate-200",children:["$",(e.product.priceCents*e.quantity/100).toFixed(2)]})]})]},e.product.id))}),(0,s.jsxs)("div",{className:"rounded-lg bg-slate-950/70 p-3 ring-1 ring-slate-800",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-300",children:[(0,s.jsxs)("span",{children:["Items (",e.length,")"]}),(0,s.jsxs)("span",{children:["$",(p/100).toFixed(2)]})]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center justify-between text-xs text-slate-400",children:[(0,s.jsx)("span",{children:"Estimated fees"}),(0,s.jsx)("span",{children:"$0.00"})]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"font-semibold text-slate-200",children:"Total"}),(0,s.jsxs)("span",{className:"text-[13px] font-semibold text-red-200",children:["$",(p/100).toFixed(2)]})]}),(0,s.jsxs)("button",{type:"button",disabled:0===e.length||r,onClick:h,className:"mt-3 inline-flex w-full items-center justify-center gap-1 rounded-lg bg-red-600 px-3 py-2 text-[11px] font-semibold text-white shadow-sm shadow-red-900/40 hover:bg-red-500 disabled:cursor-not-allowed disabled:bg-red-900",children:[(0,s.jsx)(c.Z,{className:"h-3.5 w-3.5"}),r?"Redirecting to Stripe...":"Checkout with Stripe"]}),f&&(0,s.jsxs)("p",{className:"mt-2 text-[10px] text-red-300",children:["Error: ",f]}),(0,s.jsxs)("div",{className:"mt-3 space-y-1 text-[9px] text-slate-500",children:[(0,s.jsxs)("p",{children:["In test mode, you can use"," ",(0,s.jsx)("span",{className:"font-mono",children:"4242 4242 4242 4242"})," with any future expiry and CVC to simulate a successful payment."]}),(0,s.jsx)("p",{children:'TODO: Add an order confirmation page and connect Stripe webhooks to mark orders as "paid" in the Neon database.'})]})]})]})]})]})}},6267:function(e,t,r){"use strict";r.d(t,{B:function(){return a},r:function(){return l}});var s=r(7437),n=r(2265);let i=(0,n.createContext)(void 0);function a(e){let{children:t}=e,[r,a]=(0,n.useState)([]);return(0,s.jsx)(i.Provider,{value:{items:r,addToCart:e=>{a(t=>t.find(t=>t.product.id===e.id)?t.map(t=>t.product.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{product:e,quantity:1}])},removeFromCart:e=>{a(t=>t.filter(t=>t.product.id!==e))},clearCart:()=>a([])},children:t})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useMarketplaceCart must be used within MarketplaceCartProvider");return e}},9178:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(7437),n=r(1994);function i(e){let{children:t,className:r}=e;return(0,s.jsx)("div",{className:(0,n.W)("rounded-2xl border border-slate-500/90 bg-slate-200/80 p-4 shadow-lg shadow-black/40",r),children:t})}},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var s=r(2265);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:o="",children:d,iconNode:u,...x}=e;return(0,s.createElement)("svg",{ref:t,...a,width:n,height:n,stroke:r,strokeWidth:c?24*Number(l)/Number(n):l,className:i("lucide",o),...x},[...u.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),c=(e,t)=>{let r=(0,s.forwardRef)((r,a)=>{let{className:c,...o}=r;return(0,s.createElement)(l,{ref:a,iconNode:t,className:i("lucide-".concat(n(e)),c),...o})});return r.displayName="".concat(e),r}},2660:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},8226:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},6275:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},3145:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var s=r(8461),n=r.n(s)},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var s=r(2972),n=r.n(s)},8461:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return c},getImageProps:function(){return l}});let s=r(7043),n=r(5346),i=r(5878),a=s._(r(5084));function l(e){let{props:t}=(0,n.getImgProps)(e,{defaultLoader:a.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let c=i.Image},1994:function(e,t,r){"use strict";function s(){for(var e,t,r=0,s="",n=arguments.length;r<n;r++)(e=arguments[r])&&(t=function e(t){var r,s,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(r=0;r<i;r++)t[r]&&(s=e(t[r]))&&(n&&(n+=" "),n+=s)}else for(s in t)t[s]&&(n&&(n+=" "),n+=s)}return n}(e))&&(s&&(s+=" "),s+=t);return s}r.d(t,{W:function(){return s}}),t.Z=s}},function(e){e.O(0,[972,878,971,117,744],function(){return e(e.s=3257)}),_N_E=e.O()}]);