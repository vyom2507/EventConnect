(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{4036:function(e,t,s){Promise.resolve().then(s.bind(s,1772))},1772:function(e,t,s){"use strict";s.d(t,{MarketplaceChat:function(){return l}});var n=s(7437),r=s(2265),a=s(9178);function l(e){let{conversationId:t,currentUserId:s}=e,[l,o]=(0,r.useState)([]),[c,i]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[f,x]=(0,r.useState)(null),p=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=!0,s=async()=>{try{let s=await fetch("/api/marketplace/conversations/".concat(t,"/messages"),{cache:"no-store"});if(!s.ok)return;let n=await s.json();e&&o(n.messages)}catch(e){console.error(e)}};s();let n=setInterval(s,2e3);return()=>{e=!1,clearInterval(n)}},[t]),(0,r.useEffect)(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[l.length]);let h=async e=>{if(e.preventDefault(),c.trim()){u(!0),x(null);try{let e=await fetch("/api/marketplace/conversations/".concat(t,"/messages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:c})});if(!e.ok){let t=await e.text();throw Error(t||"Failed to send message")}i("")}catch(e){console.error(e),x(e.message||"Something went wrong")}finally{u(!1)}}};return(0,n.jsxs)(a.Z,{className:"flex h-[380px] flex-col bg-white/95 text-slate-900",children:[(0,n.jsx)("div",{className:"mb-2 text-[11px] text-slate-600",children:"Use this chat to coordinate pickup location (e.g., MTCC, library) and confirm the item before payment in person."}),(0,n.jsxs)("div",{className:"flex-1 space-y-2 overflow-y-auto rounded-lg bg-slate-50 p-2 text-xs",children:[0===l.length?(0,n.jsx)("p",{className:"text-[11px] text-slate-400",children:"No messages yet. Start the conversation!"}):l.map(e=>{let t=e.sender.id===s;return(0,n.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-[75%] rounded-xl px-3 py-1.5 text-[11px] ".concat(t?"bg-red-600 text-white":"bg-white text-slate-900 ring-1 ring-slate-200"),children:[!t&&(0,n.jsx)("p",{className:"text-[10px] font-semibold text-slate-700",children:e.sender.fullName||"Student"}),(0,n.jsx)("p",{children:e.content}),(0,n.jsx)("p",{className:"mt-0.5 text-[9px] ".concat(t?"text-red-100/80":"text-slate-400"),children:new Date(e.createdAt).toLocaleString()})]})},e.id)}),(0,n.jsx)("div",{ref:p})]}),f&&(0,n.jsx)("p",{className:"mt-1 text-[10px] text-red-600",children:f}),(0,n.jsxs)("form",{onSubmit:h,className:"mt-2 flex gap-2 border-t border-slate-200 pt-2",children:[(0,n.jsx)("input",{value:c,onChange:e=>i(e.target.value),className:"flex-1 rounded-lg border border-slate-300 px-2 py-1 text-xs focus:border-red-500 focus:outline-none focus:ring-1 focus:ring-red-500",placeholder:"Type a messageâ€¦"}),(0,n.jsx)("button",{type:"submit",disabled:d,className:"rounded-lg bg-red-600 px-3 py-1.5 text-[11px] font-semibold text-white hover:bg-red-500 disabled:opacity-60",children:"Send"})]})]})}},9178:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var n=s(7437),r=s(1994);function a(e){let{children:t,className:s}=e;return(0,n.jsx)("div",{className:(0,r.W)("rounded-2xl border border-slate-500/90 bg-slate-200/80 p-4 shadow-lg shadow-black/40",s),children:t})}},1994:function(e,t,s){"use strict";function n(){for(var e,t,s=0,n="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=function e(t){var s,n,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t){if(Array.isArray(t)){var a=t.length;for(s=0;s<a;s++)t[s]&&(n=e(t[s]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n)}return r}(e))&&(n&&(n+=" "),n+=t);return n}s.d(t,{W:function(){return n}}),t.Z=n}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4036)}),_N_E=e.O()}]);