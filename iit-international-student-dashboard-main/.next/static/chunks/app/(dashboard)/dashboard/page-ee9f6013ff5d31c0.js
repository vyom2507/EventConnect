(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{2745:function(){},5024:function(){},8801:function(e,t,s){Promise.resolve().then(s.bind(s,7606)),Promise.resolve().then(s.t.bind(s,5878,23)),Promise.resolve().then(s.t.bind(s,2972,23))},7606:function(e,t,s){"use strict";s.d(t,{RealtimeGroupChat:function(){return g}});var a=s(7437),n=s(6595),r=s(2265),l=s(8924),o=s.n(l),i=s(8793),c=s.n(i),d=s(257);let u=d.env.PUSHER_APP_ID,m=d.env.PUSHER_KEY,x=d.env.PUSHER_SECRET,h=d.env.PUSHER_CLUSTER;u&&m&&x&&h||console.warn("[PUSHER] Missing env vars. Realtime chat will not work until set."),new(o())({appId:u,key:m,secret:x,cluster:h,useTLS:!0});var f=s(2718),p=s(4743);function g(e){let{defaultRoomSlug:t="new-arrivals"}=e,[s,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(t),[u,m]=(0,r.useState)([]),[x,h]=(0,r.useState)(""),[g,b]=(0,r.useState)(!0),[j,v]=(0,r.useState)(!1),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/chat/rooms"),t=await e.json();e.ok&&l(t.rooms||[])}catch(e){console.error("Load rooms error:",e)}})()},[]),(0,r.useEffect)(()=>{let e=async()=>{b(!0);try{let e=await fetch("/api/chat/messages?room=".concat(o)),t=await e.json();e.ok&&m(t.messages||[])}catch(e){console.error("Load messages error:",e)}finally{b(!1)}};o&&e()},[o]),(0,r.useEffect)(()=>{let e=function(){let e=d.env.NEXT_PUBLIC_PUSHER_KEY,t=d.env.NEXT_PUBLIC_PUSHER_CLUSTER;return new(c())(e,{cluster:t,forceTLS:!0})}();if(!e||!o)return;let t="chat-room-".concat(o),s=e.subscribe(t),a=e=>{m(t=>[...t,e])};return s.bind("message:new",a),()=>{s.unbind("message:new",a),e.unsubscribe(t),e.disconnect()}},[o]),(0,r.useEffect)(()=>{N.current&&N.current.scrollIntoView({behavior:"smooth"})},[u]);let w=async e=>{if(e.preventDefault(),x.trim()&&o){v(!0);try{let e=await fetch("/api/chat/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomSlug:o,content:x.trim()})}),t=await e.json();e.ok?h(""):console.error("Send message error:",t.error)}catch(e){console.error("Send message error:",e)}finally{v(!1)}}},y=s.find(e=>e.slug===o);return(0,a.jsxs)("div",{className:"flex h-full min-h-[280px] flex-col rounded-2xl bg-slate-950/80 p-3 ring-1 ring-slate-800",children:[(0,a.jsx)("div",{className:"mb-3 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-red-600/20 text-red-300 ring-1 ring-red-500/40",children:(0,a.jsx)(f.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-slate-50",children:"Group messaging"}),(0,a.jsx)("p",{className:"text-[11px] text-slate-400",children:"Real-time rooms for arrivals, housing, and academic cohorts."})]})]})}),(0,a.jsx)("div",{className:"mb-2 flex gap-2 overflow-x-auto pb-1 text-[11px]",children:s.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>i(e.slug),className:"\n        flex items-center gap-1 rounded-full border px-3 py-1\n        ".concat(e.slug===o?"border-red-500 bg-red-600/40 text-red-50":"border-slate-700 bg-slate-900 text-slate-200 hover:border-red-500/70 hover:text-red-100","\n      "),children:[e.pinned&&(0,a.jsx)(n.Z,{className:"h-3 w-3 text-yellow-300"}),(0,a.jsx)("span",{children:e.name}),e.isLastActive&&(0,a.jsx)("span",{className:"ml-1 rounded-full bg-slate-800 px-1.5 py-0.5 text-[9px] text-slate-200",children:"last active"})]},e.slug))}),y&&(0,a.jsx)("p",{className:"mb-2 text-[10px] text-slate-400",children:y.description}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto rounded-xl bg-slate-950/70 p-2 text-[11px] ring-1 ring-slate-800",children:g?(0,a.jsx)("p",{className:"text-slate-400",children:"Loading messagesâ€¦"}):0===u.length?(0,a.jsx)("p",{className:"text-slate-400",children:"No messages yet. Be the first to say hello \uD83D\uDC4B"}):(0,a.jsxs)(a.Fragment,{children:[u.map(e=>(0,a.jsxs)("div",{className:"mb-1.5",children:[(0,a.jsx)("p",{className:"font-semibold text-slate-100",children:e.student.fullName}),(0,a.jsx)("p",{className:"text-slate-200",children:e.content}),(0,a.jsx)("p",{className:"text-[9px] text-slate-500",children:new Date(e.createdAt).toLocaleString()})]},e.id)),(0,a.jsx)("div",{ref:N})]})}),(0,a.jsxs)("form",{onSubmit:w,className:"mt-2 flex gap-2 text-[11px]",children:[(0,a.jsx)("input",{type:"text",className:"flex-1 rounded-lg border border-slate-700 bg-slate-950/80 px-3 py-2 text-slate-100 outline-none focus:border-red-500",placeholder:"Type a message for other IIT students...",value:x,onChange:e=>h(e.target.value)}),(0,a.jsxs)("button",{type:"submit",disabled:j||!x.trim(),className:"inline-flex items-center justify-center rounded-lg bg-red-600 px-3 py-2 text-xs font-semibold text-white shadow-sm shadow-red-900/40 hover:bg-red-500 disabled:cursor-not-allowed disabled:bg-red-300",children:[(0,a.jsx)(p.Z,{className:"mr-1 h-3 w-3"}),"Send"]})]})]})}}},function(e){e.O(0,[218,972,878,75,971,117,744],function(){return e(e.s=8801)}),_N_E=e.O()}]);