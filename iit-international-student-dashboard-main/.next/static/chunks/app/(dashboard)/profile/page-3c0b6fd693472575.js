(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[688],{5027:function(e,t,r){Promise.resolve().then(r.bind(r,2554))},2554:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var l=r(7437),n=r(2265),a=r(3145),s=r(257);let o=s.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,i=s.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET;function u(){let[e,t]=(0,n.useState)(null),[r,s]=(0,n.useState)(""),[u,c]=(0,n.useState)(""),[d,f]=(0,n.useState)(null),[p,x]=(0,n.useState)(null),[m,h]=(0,n.useState)(!0),[b,g]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),[j,N]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{h(!0);try{let e=await fetch("/api/profile"),r=await e.json();if(!e.ok){y(r.error||"Failed to load profile.");return}let l=r.student;t(l),s(l.fullName),c(l.program),f(l.avatarUrl||null)}catch(e){console.error(e),y("Failed to load profile.")}finally{h(!1)}})()},[]);let w=async()=>{if(!p)return(null==e?void 0:e.avatarUrl)||null;if(!o||!i)return console.error("Missing Cloudinary env vars"),(null==e?void 0:e.avatarUrl)||null;let t=new FormData;t.append("file",p),t.append("upload_preset",i);let r=await fetch("https://api.cloudinary.com/v1_1/".concat(o,"/upload"),{method:"POST",body:t}),l=await r.json();return r.ok?l.secure_url:(console.error("Cloudinary upload error:",l),y("Failed to upload profile image."),(null==e?void 0:e.avatarUrl)||null)},T=async e=>{if(e.preventDefault(),y(null),N(null),!r||!u){y("Full name and program are required.");return}g(!0);try{let e=await w(),l=await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:r,program:u,avatarUrl:e})}),n=await l.json();if(!l.ok)throw Error(n.error||"Failed to update profile.");t(n.student),N("Profile updated successfully.")}catch(e){y(e.message||"Failed to update profile.")}finally{g(!1)}};return m?(0,l.jsx)("p",{className:"text-sm text-slate-200",children:"Loading profile…"}):e?(0,l.jsxs)("div",{className:"max-w-xl space-y-5",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.25em] text-red-300",children:"Profile"}),(0,l.jsx)("h1",{className:"mt-1 text-xl font-semibold text-slate-50",children:"Your IIT student profile"}),(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"Keep your name, program, and profile photo up to date so your experience across the dashboard feels personal."})]}),(0,l.jsxs)("form",{onSubmit:T,className:"space-y-4 rounded-2xl bg-slate-950/80 p-4 ring-1 ring-slate-800",children:[v&&(0,l.jsx)("div",{className:"rounded-lg border border-red-500/60 bg-red-950/50 px-3 py-2 text-xs text-red-100",children:v}),j&&(0,l.jsx)("div",{className:"rounded-lg border border-emerald-500/60 bg-emerald-950/40 px-3 py-2 text-xs text-emerald-100",children:j}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[d?(0,l.jsx)(a.default,{src:d,alt:"Avatar",width:56,height:56,className:"h-14 w-14 rounded-full object-cover ring-2 ring-red-500/70"}):(0,l.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-slate-800 text-xs text-slate-400",children:"No photo"}),(0,l.jsxs)("div",{className:"flex-1 text-[11px] text-slate-300",children:[(0,l.jsx)("label",{className:"mb-1 block text-[11px] font-semibold text-slate-200",children:"Profile photo"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(x(r),f(URL.createObjectURL(r)))},className:"block w-full text-[11px] text-slate-200 file:mr-3 file:rounded-md file:border-0 file:bg-red-600 file:px-3 file:py-1.5 file:text-[11px] file:font-semibold file:text-white hover:file:bg-red-500"}),(0,l.jsx)("p",{className:"mt-1 text-[10px] text-slate-500",children:"A clear, square image works best (e.g., 400\xd7400)."})]})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"block text-[11px] font-semibold text-slate-200",children:"Full name"}),(0,l.jsx)("input",{type:"text",value:r,onChange:e=>s(e.target.value),className:"w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100 outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500"})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"block text-[11px] font-semibold text-slate-200",children:"IIT email"}),(0,l.jsx)("input",{type:"email",value:e.email,disabled:!0,className:"w-full cursor-not-allowed rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-400"})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"block text-[11px] font-semibold text-slate-200",children:"Student type"}),(0,l.jsx)("input",{value:e.studentType,disabled:!0,className:"w-full cursor-not-allowed rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-400"})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"block text-[11px] font-semibold text-slate-200",children:"Program / Major"}),(0,l.jsx)("input",{type:"text",value:u,onChange:e=>c(e.target.value),className:"w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100 outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500"})]}),(0,l.jsx)("button",{type:"submit",disabled:b,className:"mt-2 inline-flex items-center justify-center rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm shadow-red-900/40 hover:bg-red-500 disabled:cursor-not-allowed disabled:bg-red-300",children:b?"Saving changes…":"Save profile"})]})]}):(0,l.jsx)("p",{className:"text-sm text-red-300",children:"Could not load profile. Please log in again."})}},3145:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var l=r(8461),n=r.n(l)},257:function(e,t,r){"use strict";var l,n;e.exports=(null==(l=r.g.process)?void 0:l.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,l,n=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var i=[],u=!1,c=-1;function d(){u&&l&&(u=!1,l.length?i=l.concat(i):c=-1,i.length&&f())}function f(){if(!u){var e=o(d);u=!0;for(var t=i.length;t;){for(l=i,i=[];++c<t;)l&&l[c].run();c=-1,t=i.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function x(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new p(e,t)),1!==i.length||u||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=x,n.addListener=x,n.once=x,n.off=x,n.removeListener=x,n.removeAllListeners=x,n.emit=x,n.prependListener=x,n.prependOnceListener=x,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function l(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}},s=!0;try{t[e](a,a.exports,l),s=!1}finally{s&&delete r[e]}return a.exports}l.ab="//";var n=l(229);e.exports=n}()},8461:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return i},getImageProps:function(){return o}});let l=r(7043),n=r(5346),a=r(5878),s=l._(r(5084));function o(e){let{props:t}=(0,n.getImgProps)(e,{defaultLoader:s.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let i=a.Image},5523:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return l}});let l=r(7043)._(r(2265)).default.createContext(null)}},function(e){e.O(0,[878,971,117,744],function(){return e(e.s=5027)}),_N_E=e.O()}]);