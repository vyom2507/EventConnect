"use strict";(()=>{var e={};e.id=3168,e.ids=[3168],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},21764:e=>{e.exports=require("util")},72909:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>k,routeModule:()=>h,serverHooks:()=>_,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>m});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),u=r(91988),c=r(83493);let p=process.env.STRIPE_SECRET_KEY,l=process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000";p||console.warn("STRIPE_SECRET_KEY is not set");let d=p?new u.Z(p,{apiVersion:"2024-06-20"}):null;async function m(e){if(!d)return i.NextResponse.json({error:"Stripe is not configured on the server"},{status:500});try{let t=(await e.json()).items||[];if(!t.length)return i.NextResponse.json({error:"No items to checkout"},{status:400});let r=t.map(e=>({quantity:e.quantity,price_data:{currency:"usd",unit_amount:e.priceCents,product_data:{name:e.title}}})),s=await d.checkout.sessions.create({mode:"payment",line_items:r,success_url:`${l}/marketplace?success=1`,cancel_url:`${l}/marketplace/checkout?canceled=1`});return await c._.order.create({data:{stripeSessionId:s.id,amountTotal:s.amount_total??t.reduce((e,t)=>e+t.priceCents*t.quantity,0),status:"created",currency:s.currency||"usd"}}),i.NextResponse.json({url:s.url})}catch(e){return console.error("Stripe checkout error",e),i.NextResponse.json({error:e.message||"Stripe checkout error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/marketplace/checkout/route",pathname:"/api/marketplace/checkout",filename:"route",bundlePath:"app/api/marketplace/checkout/route"},resolvedPagePath:"C:\\Users\\vyoml\\iit-international-student-dashboard-main\\app\\api\\marketplace\\checkout\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:k,staticGenerationAsyncStorage:x,serverHooks:_}=h,q="/api/marketplace/checkout/route";function v(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:x})}},83493:(e,t,r)=>{r.d(t,{_:()=>a});let s=require("@prisma/client"),a=globalThis.prisma??new s.PrismaClient({log:["error","warn"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,1988],()=>r(72909));module.exports=s})();